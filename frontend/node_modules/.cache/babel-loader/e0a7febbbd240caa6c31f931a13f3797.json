{"ast":null,"code":"var _jsxFileName = \"/home/kjchan/step-react-ads/client/src/Dashboard/PageComponents/QueryDashboard/Queries.js\";\n\n/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\nimport axios from 'axios';\nimport * as HttpStatus from 'http-status-codes';\nimport { makeStyles } from '@material-ui/core/styles';\nimport QueryResults from './QueryResults';\nimport TextField from '@material-ui/core/TextField';\nimport Button from '@material-ui/core/Button';\nimport Title from '../../Utilities/Title';\nconst useStyles = makeStyles(theme => ({\n  root: {\n    margin: theme.spacing(1)\n  }\n})); //add key for table rows\n\nfunction addKey(index, responseObj) {\n  responseObj.id = index;\n  return responseObj;\n}\n\nfunction parseRows(response) {\n  const responseRows = [];\n  let i;\n\n  for (i = 0; i < response.length; i++) {\n    responseRows.push(addKey(i, response[i]));\n  }\n\n  return responseRows;\n}\n\nclass Query extends React.Component {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n    this.handleQuery = this.handleQuery.bind(this);\n    this.state = {\n      value: '',\n      rows: [],\n      fields: [],\n      rowsPerPage: 5,\n      status: 'inputRequired',\n      errorMessage: ''\n    };\n  }\n\n  handleChange(event) {\n    this.setState({\n      value: event.target.value\n    });\n  }\n\n  async handleQuery(event, exportTable) {\n    const query = this.state.value;\n\n    if (!exportTable) {\n      this.setState({\n        status: 'loading'\n      });\n    }\n\n    try {\n      const {\n        data\n      } = await axios.post('/campaign', new URLSearchParams({\n        query,\n        exportTable\n      }));\n\n      if (data.meta.status !== HttpStatus.OK.toString()) {\n        throw new Error(data.meta.message);\n      } else {\n        //don't rerender table if exporting\n        if (exportTable) {\n          alert('export successful');\n        } else {\n          this.setState({\n            rows: parseRows(data.response),\n            fields: data.fieldmask,\n            status: 'loaded'\n          });\n        }\n      }\n    } catch (err) {\n      console.log(err.message);\n      this.setState({\n        status: 'error',\n        errorMessage: err.message\n      });\n    }\n  }\n\n  pickContentToDisplay() {\n    switch (this.state.status) {\n      case 'inputRequired':\n        return /*#__PURE__*/React.createElement(Title, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 16\n          }\n        }, \" Enter a query to see the results \");\n\n      case 'loading':\n        return /*#__PURE__*/React.createElement(Title, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 100,\n            columnNumber: 16\n          }\n        }, \" Loading ... \");\n\n      case 'loaded':\n        return /*#__PURE__*/React.createElement(React.Fragment, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(QueryResults, {\n          rows: this.state.rows,\n          fields: this.state.fields,\n          rowsPerPage: this.state.rowsPerPage,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 13\n          }\n        }), /*#__PURE__*/React.createElement(ExportButton, {\n          onClick: e => this.handleQuery(e, true),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 109,\n            columnNumber: 13\n          }\n        }));\n\n      case 'error':\n        return /*#__PURE__*/React.createElement(Title, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 114,\n            columnNumber: 11\n          }\n        }, \"Something Went Wrong. Here's the Error Message: \" + this.state.errorMessage);\n\n      default:\n        return /*#__PURE__*/React.createElement(Title, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 120,\n            columnNumber: 16\n          }\n        }, \" Something Went Wrong\");\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Title, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 9\n      }\n    }, \"Query Here\"), /*#__PURE__*/React.createElement(TextField, {\n      value: this.state.value,\n      onChange: this.handleChange,\n      id: \"standard-full-width\",\n      label: \"Enter Query\",\n      style: {\n        margin: 8\n      },\n      placeholder: \"SELECT campaign.id, campaign.name FROM campaign\",\n      helperText: \"make sure to select an account!\",\n      fullWidth: true,\n      margin: \"normal\",\n      InputLabelProps: {\n        shrink: true\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(SubmitButton, {\n      onClick: e => this.handleQuery(e, false),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 9\n      }\n    }), this.pickContentToDisplay());\n  }\n\n}\n\nfunction SubmitButton(props) {\n  const classes = useStyles();\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"outlined\",\n    onClick: props.onClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 7\n    }\n  }, \"Submit\"));\n}\n\nfunction ExportButton(props) {\n  const classes = useStyles();\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"outlined\",\n    onClick: props.onClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 7\n    }\n  }, \"Export to Google Sheets\"));\n}\n\nexport default Query;","map":{"version":3,"sources":["/home/kjchan/step-react-ads/client/src/Dashboard/PageComponents/QueryDashboard/Queries.js"],"names":["React","axios","HttpStatus","makeStyles","QueryResults","TextField","Button","Title","useStyles","theme","root","margin","spacing","addKey","index","responseObj","id","parseRows","response","responseRows","i","length","push","Query","Component","constructor","props","handleChange","bind","handleQuery","state","value","rows","fields","rowsPerPage","status","errorMessage","event","setState","target","exportTable","query","data","post","URLSearchParams","meta","OK","toString","Error","message","alert","fieldmask","err","console","log","pickContentToDisplay","e","render","shrink","SubmitButton","classes","onClick","ExportButton"],"mappings":"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","sourcesContent":["/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\nimport axios from 'axios';\nimport * as HttpStatus from 'http-status-codes';\nimport { makeStyles } from '@material-ui/core/styles';\nimport QueryResults from './QueryResults';\nimport TextField from '@material-ui/core/TextField';\nimport Button from '@material-ui/core/Button';\nimport Title from '../../Utilities/Title';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    margin: theme.spacing(1),\n  },\n}));\n\n//add key for table rows\nfunction addKey(index, responseObj) {\n  responseObj.id = index;\n  return responseObj;\n}\n\nfunction parseRows(response) {\n  const responseRows = [];\n  let i;\n  for (i = 0; i < response.length; i++) {\n    responseRows.push(addKey(i, response[i]));\n  }\n  return responseRows;\n}\n\nclass Query extends React.Component {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n    this.handleQuery = this.handleQuery.bind(this);\n    this.state = {\n      value: '',\n      rows: [],\n      fields: [],\n      rowsPerPage: 5,\n      status: 'inputRequired',\n      errorMessage: '',\n    };\n  }\n\n  handleChange(event) {\n    this.setState({ value: event.target.value });\n  }\n\n  async handleQuery(event, exportTable) {\n    const query = this.state.value;\n    if (!exportTable) {\n      this.setState({ status: 'loading' });\n    }\n    try {\n      const { data } = await axios.post(\n        '/campaign',\n        new URLSearchParams({ query, exportTable }),\n      );\n      if (data.meta.status !== HttpStatus.OK.toString()) {\n        throw new Error(data.meta.message);\n      } else {\n        //don't rerender table if exporting\n        if (exportTable) {\n          alert('export successful');\n        } else {\n          this.setState({\n            rows: parseRows(data.response),\n            fields: data.fieldmask,\n            status: 'loaded',\n          });\n        }\n      }\n    } catch (err) {\n      console.log(err.message);\n      this.setState({ status: 'error', errorMessage: err.message });\n    }\n  }\n\n  pickContentToDisplay() {\n    switch (this.state.status) {\n      case 'inputRequired':\n        return <Title> Enter a query to see the results </Title>;\n      case 'loading':\n        return <Title> Loading ... </Title>;\n      case 'loaded':\n        return (\n          <React.Fragment>\n            <QueryResults\n              rows={this.state.rows}\n              fields={this.state.fields}\n              rowsPerPage={this.state.rowsPerPage}\n            />\n            <ExportButton onClick={(e) => this.handleQuery(e, true)} />\n          </React.Fragment>\n        );\n      case 'error':\n        return (\n          <Title>\n            {\"Something Went Wrong. Here's the Error Message: \" +\n              this.state.errorMessage}\n          </Title>\n        );\n      default:\n        return <Title> Something Went Wrong</Title>;\n    }\n  }\n\n  render() {\n    return (\n      <React.Fragment>\n        <Title>Query Here</Title>\n        <TextField\n          value={this.state.value}\n          onChange={this.handleChange}\n          id=\"standard-full-width\"\n          label=\"Enter Query\"\n          style={{ margin: 8 }}\n          placeholder=\"SELECT campaign.id, campaign.name FROM campaign\"\n          helperText=\"make sure to select an account!\"\n          fullWidth\n          margin=\"normal\"\n          InputLabelProps={{\n            shrink: true,\n          }}\n        />\n        <SubmitButton onClick={(e) => this.handleQuery(e, false)} />\n        {this.pickContentToDisplay()}\n      </React.Fragment>\n    );\n  }\n}\n\nfunction SubmitButton(props) {\n  const classes = useStyles();\n  return (\n    <div className={classes.root}>\n      <Button variant=\"outlined\" onClick={props.onClick}>\n        Submit\n      </Button>\n    </div>\n  );\n}\n\nfunction ExportButton(props) {\n  const classes = useStyles();\n  return (\n    <div className={classes.root}>\n      <Button variant=\"outlined\" onClick={props.onClick}>\n        Export to Google Sheets\n      </Button>\n    </div>\n  );\n}\n\nexport default Query;\n"]},"metadata":{},"sourceType":"module"}